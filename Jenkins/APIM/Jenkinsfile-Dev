pipeline {
    agent any
    tools {
        maven 'Maven 3.3.9'
        jdk 'jdk8'
    }
    stages {
        stage ('Initialize') {
            steps {
                sh '''
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/wso2/products/apimcli:$PATH
                    newman -v
                    apimcli version
                '''
                git 'https://github.com/Madhuka/sample-integration.git'
            }
        }
        stage('Build-Deploy-Dependency') {
            steps {
                echo 'Build-Deploy-Dependency..'
                sh '''
                    git checkout apim
                    git pull
                    cd APIM
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/wso2/products/apimcli:$PATH
                    apimcli version
                    apimcli login dev -u admin -p admin -k
                    apimcli import-api --file ./PetstoreAPI --environment dev -k
                '''
            }
        }
        stage('Test') {
            steps {
                echo 'Integration Automation Testing..'
                sh '''
                    echo "PATH = ${PATH}"
                    
                '''
            }
        }
        stage ('Invoke_Prod_Pipeline') {
            steps {
                build job: 'APIM_PetStore_PROD', parameters: [
                string(name: 'param1', value: "true")
                ]
            }
        }
        
    }
}
