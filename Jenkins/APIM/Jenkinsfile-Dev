pipeline {
    agent any
    tools {
        maven 'Maven 3.3.9'
        jdk 'jdk8'
    }
    stages {
        stage ('Initialize') {
            steps {
                sh '''
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/WSO2/apictl:$PATH
                    newman -v
                    apictl version
                '''
                git 'https://github.com/Madhuka/sample-integration.git'
            }
        }
        stage('Build-Deploy-Dependency') {
            steps {
                echo 'Build-Deploy-Dependency..'
                sh '''
                    git checkout apim4
                    git pull
                    cd APIM
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/WSO2/apictl:$PATH
                    apictl version
                    apictl login dev -u admin -p admin -k
                    apictl delete api -n SwaggerPetstoreDemo -v 1.0.5 -e dev -k
                    apictl import api -f ./PetstoreAPI -e dev --params PetstoreAPI/api_params.yaml -k
                '''
            }
        }
        stage('Test') {
            steps {
                echo 'Integration Automation Testing..'
                sh '''
                    echo "PATH = ${PATH}"
                    
                '''
            }
        }
        stage ('Invoke_Prod_Pipeline') {
            steps {
                build job: 'APIM4_PetStore_PROD', parameters: [
                string(name: 'param1', value: "true")
                ]
            }
        }
        
    }
}
