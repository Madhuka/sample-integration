pipeline {
    agent any
    tools {
        maven 'Maven 3.3.9'
        jdk 'jdk8'
    }
    stages {
        stage ('Initialize') {
            steps {
                sh '''
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/WSO2/apictl:$PATH
                    newman -v
                    apictl version
                '''
                git 'https://github.com/Madhuka/sample-integration.git'
            }
        }
        stage('Build-Deploy-Dependency') {
            steps {
                echo 'Build-Deploy-Dependency..'
                sh '''
                    git checkout apim4
                    git pull
                    cd APIM
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/WSO2/apictl:$PATH
                    apictl version
                    apictl login prod -u admin -p admin -k
                    apictl import api -f ./PetstoreAPI -e prod --params PetstoreAPI/api_params.yaml -k
                '''
            }
        }
        
    }
}
