pipeline {
    agent any
    tools {
        maven 'Maven 3.3.9'
        jdk 'jdk8'
    }
    stages {
        stage ('Initialize') {
            steps {
                sh '''
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/wso2/products/apimcli:$PATH
                    newman -v
                    apimcli version
                '''
                git 'https://github.com/Madhuka/sample-integration.git'
            }
        }
        stage('Build-Deploy-Dependency') {
            steps {
                echo 'Build-Deploy-Dependency..'
                sh '''
                    git checkout apim
                    git pull
                    cd APIM
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                    PATH=/usr/local/bin:$PATH
                    PATH=/Users/madhka/Dev/wso2/products/apimcli:$PATH
                    apimcli version
                    apimcli login prod -u admin -p admin -k
                    apimcli import-api --file ./PetstoreAPI --environment prod -k
                '''
            }
        }
        
    }
}
